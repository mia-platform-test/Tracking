{
  "applications": {},
  "collections": {},
  "endpoints": {},
  "groups": [],
  "secrets": [],
  "cmsCategories": {},
  "cmsSettings": {
    "accessGroupsExpression": "isBackoffice && groups.admin"
  },
  "cmsAnalytics": {},
  "cmsDashboard": [],
  "decorators": {
    "preDecorators": {},
    "postDecorators": {}
  },
  "serviceAccounts": {
    "api-gateway": {
      "name": "api-gateway"
    }
  },
  "services": {
    "api-gateway": {
      "type": "custom",
      "advanced": false,
      "name": "api-gateway",
      "dockerImage": "nexus.mia-platform.eu/cache/envoyproxy/envoy:v1.29.2",
      "replicas": 1,
      "serviceAccountName": "api-gateway",
      "logParser": "mia-json",
      "description": "Envoy API Gateway to route requests to the correct service and verify the need of authentication",
      "environment": [
        {
          "name": "LOG_LEVEL",
          "valueType": "plain",
          "value": "{{LOG_LEVEL}}"
        },
        {
          "name": "MICROSERVICE_GATEWAY_SERVICE_NAME",
          "valueType": "plain",
          "value": "microservice-gateway"
        },
        {
          "name": "TRUSTED_PROXIES",
          "valueType": "plain",
          "value": "10.0.0.0/8,172.16.0.0/12,192.168.0.0/16"
        },
        {
          "name": "HTTP_PORT",
          "valueType": "plain",
          "value": "3000"
        },
        {
          "name": "USERID_HEADER_KEY",
          "valueType": "plain",
          "value": "miauserid"
        },
        {
          "name": "GROUPS_HEADER_KEY",
          "valueType": "plain",
          "value": "miausergroups"
        },
        {
          "name": "CLIENTTYPE_HEADER_KEY",
          "valueType": "plain",
          "value": "client-type"
        },
        {
          "name": "BACKOFFICE_HEADER_KEY",
          "valueType": "plain",
          "value": "isbackoffice"
        },
        {
          "name": "USER_PROPERTIES_HEADER_KEY",
          "valueType": "plain",
          "value": "miauserproperties"
        }
      ],
      "annotations": [
        {
          "name": "mia-platform.eu/version",
          "value": "14.1.0-alpha.0",
          "description": "Version of Mia-Platform used by the project",
          "readOnly": true
        },
        {
          "name": "fluentbit.io/parser",
          "value": "pino",
          "description": "Pino parser annotation for Fluent Bit",
          "readOnly": true
        }
      ],
      "labels": [
        {
          "name": "app",
          "value": "api-gateway",
          "description": "Name of the microservice, in the service selector",
          "readOnly": true,
          "isSelector": false
        },
        {
          "name": "app.kubernetes.io/name",
          "value": "api-gateway",
          "description": "Name of the microservice",
          "readOnly": true,
          "isSelector": false
        },
        {
          "name": "app.kubernetes.io/version",
          "value": "v1.29.2",
          "description": "Tag of the Docker image",
          "readOnly": true,
          "isSelector": false
        },
        {
          "name": "app.kubernetes.io/component",
          "value": "custom",
          "description": "Microservice kind, for the Console",
          "readOnly": true,
          "isSelector": false
        },
        {
          "name": "app.kubernetes.io/part-of",
          "value": "tracking",
          "description": "Project that own the microservice",
          "readOnly": true,
          "isSelector": false
        },
        {
          "name": "app.kubernetes.io/managed-by",
          "value": "mia-platform",
          "description": "Identify who manage the service",
          "readOnly": true,
          "isSelector": false
        },
        {
          "name": "mia-platform.eu/stage",
          "value": "{{STAGE_TO_DEPLOY}}",
          "description": "Environment used for the deploy",
          "readOnly": true,
          "isSelector": false
        },
        {
          "name": "mia-platform.eu/tenant",
          "value": "c1d106ff-4716-49a1-88e2-940b21705986",
          "description": "Tenant owner of the project",
          "readOnly": true,
          "isSelector": false
        },
        {
          "name": "mia-platform.eu/log-type",
          "value": "mia-json",
          "description": "Format of logs for the microservice",
          "readOnly": true,
          "isSelector": false
        }
      ],
      "resources": {
        "cpuLimits": {
          "max": "200m",
          "min": "150m"
        },
        "memoryLimits": {
          "max": "250Mi",
          "min": "150Mi"
        }
      },
      "probes": {
        "liveness": {
          "path": "/healthz",
          "port": "frontend",
          "initialDelaySeconds": 15,
          "periodSeconds": 20,
          "timeoutSeconds": 1,
          "failureThreshold": 3
        },
        "readiness": {
          "path": "/healthz",
          "port": "frontend",
          "initialDelaySeconds": 5,
          "periodSeconds": 10,
          "timeoutSeconds": 1,
          "successThreshold": 1,
          "failureThreshold": 3
        },
        "startup": {}
      },
      "tags": [
        "custom"
      ],
      "swaggerPath": "",
      "configMaps": [
        {
          "name": "api-gateway-envoy-config",
          "mountPath": "/etc/envoy",
          "viewAsReadOnly": true,
          "link": {
            "targetSection": "endpoints"
          }
        }
      ],
      "sourceComponentId": "api-gateway-envoy",
      "sourceMarketplaceItem": {
        "itemId": "envoy-api-gateway",
        "version": "1.29.2",
        "tenantId": "mia-platform"
      },
      "createdAt": "2025-09-19T14:16:38.784Z",
      "containerPorts": [
        {
          "name": "frontend",
          "from": 8080,
          "to": 8080
        },
        {
          "name": "backoffice",
          "from": 8081,
          "to": 8081
        },
        {
          "name": "admin",
          "from": 9901,
          "to": 9901
        }
      ],
      "execPreStop": [
        "bash",
        "-c",
        "echo -e 'POST /drain_listeners?graceful HTTP/1.1\r\nHost: localhost:9901\r\n\r' > /dev/tcp/localhost/9901 && sleep 55s"
      ],
      "args": [
        "-c",
        "/etc/envoy/envoy.json",
        "-l",
        "{{LOG_LEVEL}}",
        "--log-format",
        "{\"level\":\"%l\",\"time\":\"%Y-%m-%dT%T.%fZ\",\"scope\":\"%n\",\"message\":\"%j\"}",
        "--drain-time-s",
        "50"
      ],
      "terminationGracePeriodSeconds": 60
    }
  },
  "configMaps": {
    "api-gateway-envoy-config": {
      "name": "api-gateway-envoy-config",
      "gitFilesFolder": "api-gateway/envoy",
      "files": [
        {
          "name": "cds.json"
        },
        {
          "name": "lds.json"
        },
        {
          "name": "envoy.json"
        }
      ]
    }
  },
  "serviceSecrets": {},
  "apiVersions": [],
  "unsecretedVariables": [
    {
      "name": "STAGE_TO_DEPLOY",
      "environments": {
        "dev": {
          "value": "dev"
        }
      }
    }
  ],
  "listeners": {
    "frontend": {
      "name": "frontend",
      "port": 8080,
      "description": "Default listener for frontend API",
      "selectedByDefault": true
    }
  },
  "lastCommitAuthor": "Davide Patti",
  "version": "0.61.0",
  "servicesToDeploy": {
    "api-gateway": {
      "type": "custom",
      "name": "api-gateway",
      "tags": [
        "custom"
      ],
      "version": "v1.29.2",
      "checksum": "1af55df181bc2a102f72ab8d6157b5988b1e3b9b2e03bbf75db66e4fa45c4d35"
    }
  },
  "platformVersion": "14.1.0-alpha.0",
  "updatedAt": "2025-09-19T14:21:01.051Z"
}